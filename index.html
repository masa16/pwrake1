<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Pwrake : Parallel workflow extension for Rake">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Pwrake</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/masa16/pwrake">View on GitHub</a>

          <h1 id="project_title">Pwrake</h1>
          <h2 id="project_tagline">Parallel workflow extension for Rake</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/masa16/pwrake/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/masa16/pwrake/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="pwrake" class="anchor" href="#pwrake"><span class="octicon octicon-link"></span></a>Pwrake</h1>

<p>Parallel workflow extension for Rake</p>

<ul>
<li>Author: Masahiro Tanaka</li>
</ul>

<p>(<a href="https://github.com/masa16/pwrake/wiki/Pwrake.ja">README in Japanese</a>),
(<a href="https://github.com/masa16/pwrake">GitHub Repository</a>)</p>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>Parallelize all tasks; no need to modify Rakefile, no need to use <code>multitask</code>.</li>
<li>Tasks are executed in the given number of worker threads.</li>
<li>Remote exuecution using SSH.</li>
<li>Pwrake is an extension to Rake, not patch to Rake: Rake and Pwrake coexist.</li>
<li>High parallel I/O performance using Gfarm file system.</li>
</ul>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Download source tgz/zip and expand, cd to subdir and install:</p>

<pre><code>$ ruby setup.rb
</code></pre>

<p>Or, gem install:</p>

<pre><code>$ gem install pwrake
</code></pre>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a name="parallel-execution-using-4-cores-at-localhost" class="anchor" href="#parallel-execution-using-4-cores-at-localhost"><span class="octicon octicon-link"></span></a>Parallel execution using 4 cores at localhost:</h3>

<pre><code>$ pwrake -j 4
</code></pre>

<h3>
<a name="parallel-execution-using-all-cores-at-localhost" class="anchor" href="#parallel-execution-using-all-cores-at-localhost"><span class="octicon octicon-link"></span></a>Parallel execution using all cores at localhost:</h3>

<pre><code>$ pwrake -j
</code></pre>

<h3>
<a name="parallel-execution-using-total-22-cores-at-remote-2-hosts" class="anchor" href="#parallel-execution-using-total-22-cores-at-remote-2-hosts"><span class="octicon octicon-link"></span></a>Parallel execution using total 2*2 cores at remote 2 hosts:</h3>

<ol>
<li>Share your directory among remote hosts via distributed file system such as NFS, Gfarm.</li>
<li>Allow passphrase-less access via SSH in either way:

<ul>
<li>Add passphrase-less key generated by <code>ssh-keygen</code>.  (Be careful)</li>
<li>Add passphrase using <code>ssh-add</code>.</li>
</ul>
</li>
<li>
<p>Make <code>hosts</code> file in which remote host names and the number of cores are listed:</p>

<pre><code>$ cat hosts
host1 2
host2 2
</code></pre>
</li>
<li>
<p>Run <code>pwrake</code> with an option <code>--hostfile</code> or <code>-F</code>:</p>

<pre><code>$ pwrake --hostfile=hosts
</code></pre>
</li>
</ol>

<h2>
<a name="options" class="anchor" href="#options"><span class="octicon octicon-link"></span></a>Options</h2>

<h3>
<a name="command-line-option" class="anchor" href="#command-line-option"><span class="octicon octicon-link"></span></a>Command line option</h3>

<pre><code>    -F, --hostfile FILE              [Pw] Read hostnames from FILE
    -j, --jobs [N]                   [Pw] Number of threads at localhost (default: # of processors)
    -L, --logfile [FILE]             [Pw] Write log to FILE
        --ssh-opt, --ssh-option OPTION
                                     [Pw] Option passed to SSH
        --filesystem FILESYSTEM      [Pw] Specify FILESYSTEM (nfs|gfarm)
        --gfarm                      [Pw] FILESYSTEM=gfarm
    -A, --disable-affinity           [Pw] Turn OFF affinity (AFFINITY=off)
    -S, --disable-steal              [Pw] Turn OFF task steal
    -d, --debug                      [Pw] Output Debug messages
        --pwrake-conf [FILE]         [Pw] Pwrake configuation file in YAML
        --show-conf, --show-config   [Pw] Show Pwrake configuration options
        --report LOG                 [Pw] Report profile HTML from LOG and exit.
</code></pre>

<h3>
<a name="pwrake_confyaml" class="anchor" href="#pwrake_confyaml"><span class="octicon octicon-link"></span></a>pwrake_conf.yaml</h3>

<ul>
<li>If <code>pwrake_conf.yaml</code> exists at current directory, Pwrake reads options from it.</li>
<li>
<p>Example (in YAML form):</p>

<pre><code>HOSTFILE : hosts
LOGFILE : true
TASKLOG : true
PROFILE : true
GNU_TIME : true
PLOT_PARALLELISM : true
DISABLE_AFFINITY: true
DISABLE_STEAL: true
FAILED_TARGET : delete
PASS_ENV :
 - ENV1
 - ENV2
</code></pre>
</li>
<li>
<p>Option list:</p>

<pre><code>HOSTFILE, HOSTS   default=false
LOGFILE, LOG      default=none, string=filename, true="Pwrake%Y%m%d-%H%M%S_%$.log"
TASKLOG           default=none, string=filename, true="Pwrake%Y%m%d-%H%M%S_%$.task"
PROFILE           default=none, string=filename, true="Pwrake%Y%m%d-%H%M%S_%$.csv"
WORK_DIR          default=$PWD
FILESYSTEM        default=nil (autodetect)
SSH_OPTION        (String) SSH option
PASS_ENV          (Array) Environment variables passed to SSH
GNU_TIME          If true, obtains PROFILEs using GNU time
PLOT_PARALLELISM  If true, plot parallelism using GNUPLOT
FAILED_TARGET     ( rename(default) | delete | leave ) failed files
QUEUE_PRIORITY          RANK(default), FIFO, LIFO, LIHR
NOACTION_QUEUE_PRIORITY FIFO(default), LIFO, RAND
NUM_NOACTION_THREADS    default=4 when gfarm, else 1
THREAD_CREATE_INTERVAL  default=0.01 (sec)
HALT_QUEUE_WHILE_SEARCH true|false
GRAPH_PARTITION         true|false
</code></pre>

<p>for Gfarm system:</p>

<pre><code>  DISABLE_AFFINITY  default=false
  DISABLE_STEAL     default=false
  STEAL_WAIT        default=0 (sec)
  STEAL_WAIT_MAX    default=10 (sec)
   : Wait min(STEAL_WAIT*2**n, STEAL_WAIT_MAX) sec for task steal.
  GFARM_BASEDIR     default="/tmp"
  GFARM_PREFIX      default="pwrake_$USER"
  GFARM_SUBDIR      default='/'
  MAX_GFWHERE_WORKER  default=8
</code></pre>
</li>
</ul>

<h2>
<a name="note-for-gfarm" class="anchor" href="#note-for-gfarm"><span class="octicon octicon-link"></span></a>Note for Gfarm</h2>

<ul>
<li>
<p><code>gfwhere-pipe</code> script (included in Pwrake) is used for file-affinity scheduling.
This script requires Ruby/FFI (<a href="https://github.com/ffi/ffi">https://github.com/ffi/ffi</a>). Install FFI by</p>

<pre><code>  gem install ffi
</code></pre>
</li>
</ul>

<h2>
<a name="for-graph-partitioning" class="anchor" href="#for-graph-partitioning"><span class="octicon octicon-link"></span></a>For Graph Partitioning</h2>

<ul>
<li><p>Compile and Install METIS 5.1.0 (<a href="http://www.cs.umn.edu/%7Emetis/">http://www.cs.umn.edu/~metis/</a>). This requires CMake.</p></li>
<li>
<p>Install RbMetis (<a href="https://github.com/masa16/rbmetis">https://github.com/masa16/rbmetis</a>) by</p>

<pre><code>gem install rbmetis -- \
 --with-metis-include=/usr/local/include \
 --with-metis-lib=/usr/local/lib
</code></pre>
</li>
</ul>

<h2>
<a name="tested-platform" class="anchor" href="#tested-platform"><span class="octicon octicon-link"></span></a>Tested Platform</h2>

<ul>
<li>Ruby 2.1.4</li>
<li>Rake 10.1.0</li>
<li>CentOS 6.4</li>
</ul>

<h2>
<a name="acknowledgment" class="anchor" href="#acknowledgment"><span class="octicon octicon-link"></span></a>Acknowledgment</h2>

<p>This work is supported by</p>

<ul>
<li>JST CREST, research area: "Development of System Software Technologies for Post-Peta Scale High Performance Computing," and</li>
<li>MEXT Promotion of Research for Next Generation IT Infrastructure "Resources Linkage for e-Science (RENKEI)."</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Pwrake maintained by <a href="https://github.com/masa16">masa16</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
